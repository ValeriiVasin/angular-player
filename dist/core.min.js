angular.module("Player.Audio",[]).factory("Audio",["$rootScope",function(e){function n(e){return"undefined"==typeof e?e:(f.src=l.src=e,void(c={start:0,end:0}))}function t(e){return"undefined"==typeof e?l.volume:(l.volume=e,f.volume=e/100,void localStorage.setItem("volume",e))}function r(e){"undefined"!=typeof e&&n(e),l.paused=l.ended=!1,f.play()}function o(){l.paused=!0,f.pause()}function u(e){"undefined"==typeof e&&(e=!l.paused),e?o():r()}function i(e){return"undefined"==typeof e?l.time:void(1/0!==a("duration")&&(f.currentTime=l.time=e))}function a(e,n){if(!l.hasOwnProperty(e))throw new Error("prop `"+e+"` does not exist");if("undefined"==typeof n)return l[e];switch(l[e]=n,e){case"loop":f.loop=Boolean(n)}}function d(){return c}var f=new Audio,l={src:null,time:0,volume:localStorage.getItem("volume"),duration:0,paused:!0,muted:!1,ended:!1,loop:!1},c={start:0,end:0},p=Math.floor,s={play:r,time:i,prop:a,volume:t,getProgress:d,togglePause:u};return t(l.volume?Number(l.volume):100),$(f).attr("preload","auto").on({timeupdate:function(){l.time=p(f.currentTime),e.$apply()},ended:function(){a("ended",!0),e.$apply()},durationchange:function(){a("duration",f.duration),e.$apply()},progress:function(){var n=f.buffered,t=n.length-1;0!==n.length&&(c={start:n.start(t),end:n.end(t)},e.$apply())}}),s}]),angular.module("Player.Duration",[]).factory("Utils",function(){function e(e,n,t){for(n=n||2,t=t||"0",e=e.toString();e.length<n;)e=t+e;return e}return{pad:e}}).filter("duration",["Utils",function(e){return function(n){if(0===n)return"00:00";if(n===-1/0||1/0===n)return"âˆž";var t=0>n?"-":"";n=Math.abs(n);var r=e.pad(Math.floor(n/60)),o=e.pad(n%60);return t=t+r+":"+o}}]),angular.module("Player.Navigation",["Player.Playlist"]).factory("Navigation",["Playlist",function(e){function n(e){u.index=e}function t(){u.index=0}function r(){u.index=e.nextIndex(u.index)}function o(){u.index=e.prevIndex(u.index)}var u={next:r,prev:o,set:n,reset:t,index:0};return u}]),angular.module("Player.Playlist",["Player.Audio","Player.Queue"]).factory("Playlist",["$q","Audio","Queue",function(e,n,t){function r(e,n){if(u(e))throw new Error("Playlist with name `"+e+"` exists");return n=angular.copy(n),n.forEach(function(e){var n=y.push(e);e._index=n-1}),s[e]=n,v+=1,1===v&&o(e),m}function o(e){if(!u(e))return!1;if(g.name!==e)return g.name=e,g.songs=s[e],g.length=s[e].length,m.currentSong=i(0),!0}function u(e){return s.hasOwnProperty(e)}function i(e){return g.songs[e]}function a(e){var n;return"undefined"==typeof e&&(e=g.songs.indexOf(m.currentSong),-1===e&&(e=0)),n=e+1,n<g.length?n:0}function d(e){var n;return"undefined"==typeof e&&(e=g.songs.indexOf(m.currentSong),-1===e&&(e=0)),n=e-1,n>=0?n:g.length-1}function f(t){"number"==typeof t&&(t=y[t]),"function"==typeof m.beforePlay?e.when(m.beforePlay(t)).then(function(){m.currentSong=t,n.play(t.url)}):(m.currentSong=t,n.play(t.url))}function l(e){var n=i(e);t.prev(n._index),f(n)}function c(){var e,n=t.next();return"undefined"==typeof n?(e=i(a()),t.prev(e._index),void f(e)):(t.prev(n),void f(n))}function p(){var e,n=t.prev();return"undefined"==typeof n?(e=i(d()),void f(e)):void f(n)}var s={},y=[],v=0,g={songs:[],name:null},m={add:r,use:o,has:u,current:g,currentSong:null,getSong:i,prevIndex:d,nextIndex:a,play:f,next:c,prev:p,playByPosition:l};return m}]),angular.module("Player.Queue",[]).factory("Queue",[function(){function e(e){return"undefined"==typeof e?a.shift():void a.push(e)}function n(n){o(n)?t(n):e(n)}function t(e){o(e)&&a.splice(r(e),1)}function r(e){var n=a.indexOf(e);return-1===n?null:n}function o(e){return-1!==a.indexOf(e)}function u(e){return"undefined"==typeof e?d.pop():void d.push(e)}function i(){a=[],d=[]}var a=[],d=[];return{addToNext:e,next:e,position:r,removeFromNext:t,toggleNext:n,addToPrev:u,prev:u,reset:i}}]),angular.module("Player.Shortcuts",["Player.Audio","Player.Navigation","Player.Queue","Player.Playlist"]).directive("playerShortcuts",["$document","Audio","Navigation","Queue","Playlist",function(e,n,t,r,o){return{restrict:"A",link:function(u){function i(e){var i;switch(e.which){case 81:r.toggleNext(o.getSong(t.index)._index),e.preventDefault();break;case 32:n.togglePause(),e.preventDefault();break;case 40:t.next(),e.preventDefault();break;case 38:t.prev(),e.preventDefault();break;case 13:i=o.getSong(t.index),r.prev(i._index),o.play(i),e.preventDefault();break;case 84:}u.$apply()}e.on("keydown",i),u.$on("$destroy",function(){e.off("keydown",i)})}}}]);