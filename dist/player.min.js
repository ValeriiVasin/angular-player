!function(e){try{e=angular.module("Player.Templates")}catch(n){e=angular.module("Player.Templates",[])}e.run(["$templateCache",function(e){e.put("player.html",'<div class="b-player"><div class="b-player__controls__info"><div class="b-player__controls__info__artist" ng-bind="player.currentSong.artist"></div><div class="b-player__controls__info__title" ng-bind="player.currentSong.title"></div></div><div class="b-player__controls__navigation"><div class="b-player__controls__navigation__prev"><div class="b-player__controls__navigation__prev-btn" ng-click="player.controls.prev()"></div></div><div class="b-player__controls__navigation__play"><div ng-click="player.controls.togglePause()" ng-show="player.state.paused" class="b-player__controls__navigation__play__play"></div><div ng-click="player.controls.togglePause()" ng-hide="player.state.paused" class="b-player__controls__navigation__play__pause"></div></div><div class="b-player__controls__navigation__next"><div class="b-player__controls__navigation__next-btn" ng-click="player.controls.next()"></div></div></div><div class="clear"></div><div class="b-player__controls__splitter"></div><div class="b-player__controls__playback"><div slider="player.time" slider-update="player.setTime(progress)" slider-max="player.duration" slider-preload="player.downloadProgress" class="slider b-player__controls__playback__progress"><div class="b-player__controls__playback__progress__download" ng-style="player.downloadProgress"></div></div><div ng-class="{\n        \'b-player__controls__playback__time--left\': player.state.elapsed\n      }" class="b-player__controls__playback__time"><div ng-bind="player.time | duration" ng-click="player.showTimeElapsed(true)" class="b-player__controls__playback__time__elapsed"></div><div ng-bind="(player.time - player.duration) | duration" ng-click="player.showTimeElapsed(false)" class="b-player__controls__playback__time__left"></div></div></div><ul class="b-player__controls__buttons"><li ng-click="player.controls.toggleLoop()" ng-class="{\n        \'b-player__controls__buttons__loop--active\': player.state.loop,\n        \'b-player__controls__buttons__loop\': !player.state.loop\n      }"></li></ul><div class="b-player__controls__volume"><div class="b-player__controls__volume__low"></div><div slider="player.volume" class="b-player__controls__volume__progress slider"></div><div class="b-player__controls__volume__high"></div></div><div class="clear"></div><div class="b-player-search"><input type="search" name="search" class="b-player-search-dialog" autocomplete="off"></div><div class="clear"></div><ul class="b-player-playlist"><li ng-class="{\n        \'playing\':  player.isCurrentSong(song),\n        \'selected\': player.isSelected($index),\n        \'queued\':   player.positionInsideQueue(song)\n      }" ng-dblclick="player.playSong(song)" ng-click="player.setSelected($index)" ng-repeat="song in player.songs" class="b-player-playlist-item"><div class="b-player-playlist-item-inner b-state"><span ng-bind="player.positionInsideQueue(song)"></span></div><div class="b-player-playlist-item-inner b-position" ng-bind="$index + 1"></div><div class="b-player-playlist-item-inner b-song" ng-bind="song.artist + \' - \' + song.title"></div><div class="b-player-playlist-item-inner b-duration" ng-if="song.duration" ng-bind="song.duration | duration"></div></li></ul></div>')}])}(),angular.module("Player.Audio",[]).factory("Audio",["$rootScope",function(e){function n(e){return"undefined"==typeof e?e:(u.src=d.src=e,void(c={start:0,end:0}))}function t(e){return"undefined"==typeof e?d.volume:(d.volume=e,u.volume=e/100,void localStorage.setItem("volume",e))}function r(e){"undefined"!=typeof e&&n(e),d.paused=d.ended=!1,u.play()}function o(){d.paused=!0,u.pause()}function i(e){"undefined"==typeof e&&(e=!d.paused),e?o():r()}function a(e){return"undefined"==typeof e?d.time:void(1/0!==l("duration")&&(u.currentTime=d.time=e))}function l(e,n){if(!d.hasOwnProperty(e))throw new Error("prop `"+e+"` does not exist");if("undefined"==typeof n)return d[e];switch(d[e]=n,e){case"loop":u.loop=Boolean(n)}}function s(){return c}var u=new Audio,d={src:null,time:0,volume:localStorage.getItem("volume"),duration:0,paused:!0,muted:!1,ended:!1,loop:!1},c={start:0,end:0},p=Math.floor,y={play:r,time:a,prop:l,volume:t,getProgress:s,togglePause:i};return t(d.volume?Number(d.volume):100),$(u).attr("preload","auto").on({timeupdate:function(){d.time=p(u.currentTime),e.$apply()},ended:function(){l("ended",!0),e.$apply()},durationchange:function(){l("duration",u.duration),e.$apply()},progress:function(){var n=u.buffered,t=n.length-1;0!==n.length&&(c={start:n.start(t),end:n.end(t)},e.$apply())}}),y}]),angular.module("Player.Duration",[]).factory("Utils",function(){function e(e,n,t){for(n=n||2,t=t||"0",e=e.toString();e.length<n;)e=t+e;return e}return{pad:e}}).filter("duration",["Utils",function(e){return function(n){if(0===n)return"00:00";if(n===-1/0||1/0===n)return"âˆž";var t=0>n?"-":"";n=Math.abs(n);var r=e.pad(Math.floor(n/60)),o=e.pad(n%60);return t=t+r+":"+o}}]),angular.module("Player.Navigation",["Player.Playlist"]).factory("Navigation",["Playlist",function(e){function n(e){i.index=e}function t(){i.index=0}function r(){i.index=e.nextIndex(i.index)}function o(){i.index=e.prevIndex(i.index)}var i={next:r,prev:o,set:n,reset:t,index:0};return i}]),angular.module("Player.Playlist",["Player.Audio","Player.Queue"]).factory("Playlist",["$q","Audio","Queue",function(e,n,t){function r(e,n){if(i(e))throw new Error("Playlist with name `"+e+"` exists");return n=angular.copy(n),n.forEach(function(e){var n=f.push(e);e._index=n-1}),y[e]=n,_+=1,1===_&&o(e),g}function o(e){if(!i(e))return!1;if(v.name!==e)return v.name=e,v.songs=y[e],v.length=y[e].length,g.currentSong=a(0),!0}function i(e){return y.hasOwnProperty(e)}function a(e){return v.songs[e]}function l(e){var n;return"undefined"==typeof e&&(e=v.songs.indexOf(g.currentSong),-1===e&&(e=0)),n=e+1,n<v.length?n:0}function s(e){var n;return"undefined"==typeof e&&(e=v.songs.indexOf(g.currentSong),-1===e&&(e=0)),n=e-1,n>=0?n:v.length-1}function u(t){"number"==typeof t&&(t=f[t]),"function"==typeof g.beforePlay?e.when(g.beforePlay(t)).then(function(){g.currentSong=t,n.play(t.url)}):(g.currentSong=t,n.play(t.url))}function d(e){var n=a(e);t.prev(n._index),u(n)}function c(){var e,n=t.next();return"undefined"==typeof n?(e=a(l()),t.prev(e._index),void u(e)):(t.prev(n),void u(n))}function p(){var e,n=t.prev();return"undefined"==typeof n?(e=a(s()),void u(e)):void u(n)}var y={},f=[],_=0,v={songs:[],name:null},g={add:r,use:o,has:i,current:v,currentSong:null,getSong:a,prevIndex:s,nextIndex:l,play:u,next:c,prev:p,playByPosition:d};return g}]),angular.module("Player.Queue",[]).factory("Queue",[function(){function e(e){return"undefined"==typeof e?l.shift():void l.push(e)}function n(n){o(n)?t(n):e(n)}function t(e){o(e)&&l.splice(r(e),1)}function r(e){var n=l.indexOf(e);return-1===n?null:n}function o(e){return-1!==l.indexOf(e)}function i(e){return"undefined"==typeof e?s.pop():void s.push(e)}function a(){l=[],s=[]}var l=[],s=[];return{addToNext:e,next:e,position:r,removeFromNext:t,toggleNext:n,addToPrev:i,prev:i,reset:a}}]),angular.module("Player.Shortcuts",["Player.Audio","Player.Navigation","Player.Queue","Player.Playlist"]).directive("playerShortcuts",["$document","Audio","Navigation","Queue","Playlist",function(e,n,t,r,o){return{restrict:"A",link:function(i){function a(e){var a;switch(e.which){case 81:r.toggleNext(o.getSong(t.index)._index),e.preventDefault();break;case 32:n.togglePause(),e.preventDefault();break;case 40:t.next(),e.preventDefault();break;case 38:t.prev(),e.preventDefault();break;case 13:a=o.getSong(t.index),r.prev(a._index),o.play(a),e.preventDefault();break;case 84:}i.$apply()}e.on("keydown",a),i.$on("$destroy",function(){e.off("keydown",a)})}}}]),angular.module("Player",["Player.Slider","Player.Duration","Player.Queue","Player.Navigation","Player.Audio","Player.Playlist","Player.Templates","Player.Shortcuts"]).directive("player",["Queue","Audio","Playlist","Navigation",function(e,n,t,r){return{restrict:"A",templateUrl:"player.html",scope:!0,controllerAs:"player",controller:["$scope",function(o){var i=this;this.state={elapsed:!1,paused:n.prop("paused"),loop:n.prop("loop")},this.showTimeElapsed=function(e){return e?void(1/0!==n.prop("duration")&&(i.state.elapsed=!0)):void(i.state.elapsed=!1)},i.setTime=function(e){n.time(e)},o.$watch(function(){return n.prop("paused")},function(e){i.state.paused=e}),o.$watchCollection(function(){return t.current.songs},function(e){i.songs=e}),o.$watch(function(){return t.currentSong},function(e){i.currentSong=e}),o.$watch(function(){return n.prop("loop")},function(e){i.state.loop=e}),this.time=0,o.$watch(function(){return n.time()},function(e){i.time=e}),this.volume=n.volume(),o.$watch(function(){return i.volume},function(e){n.volume(e)}),o.$watch(function(){return n.prop("ended")},function(e){e&&(i.controls.next(),n.prop("ended",!1))}),this.duration=0,o.$watch(function(){return n.prop("duration")},function(e){i.duration=e}),this.downloadProgress={left:0,width:0},o.$watch(function(){return n.getProgress()},function(e,t){if(e!==t){var r=Math.floor(e.end/n.prop("duration")*100);i.downloadProgress.left=0,i.downloadProgress.width=r+"%"}}),i.selected=0,o.$watch(function(){return r.index},function(e,n){e!==n&&(i.selected=e)}),this.isSelected=function(e){return this.selected===e},this.setSelected=function(e){r.set(e)},this.positionInsideQueue=function(n){var t=e.position(n._index);return"number"==typeof t?t+1:""},this.playSong=function(n){e.prev(n._index),t.play(n)},this.isCurrentSong=function(e){return this.currentSong===e},this.controls={},this.controls.togglePause=function(){n.prop("src")?n.togglePause():i.playSong(i.currentSong)},this.controls.toggleLoop=function(){n.prop("loop",!n.prop("loop"))},this.controls.next=t.next,this.controls.prev=t.prev}]}}]),angular.module("Player.Slider",[]).directive("slider",["$timeout",function(e){return{scope:{slider:"=",update:"&sliderUpdate",max:"=sliderMax"},link:function(n,t,r){var o=!1,i="undefined"==typeof r.sliderUpdate;t.slider({range:"min",start:function(){o=!0},slide:function(t,r){i&&e(function(){n.slider=r.value})},stop:function(t,r){e(function(){o=!1,i||n.update({progress:r.value})})}}),n.$watch("slider",function(e){o||t.slider("option","value",e)}),n.$watch("max",function(e,n){e!==n&&(1/0===e?t.slider("disable"):(t.slider("enable"),t.slider("option","value",0)),t.slider("option","max",e))})}}}]);